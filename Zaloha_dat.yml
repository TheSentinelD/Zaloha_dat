---
- name: Zálohování pracovních dat uživatelů
  hosts: '{{ seznam_stanic }}'
  tasks:
   - name: Zjistí seznam podsložek složky
     win_find: 
      paths: '{{ cesta_slozky }}'
      file_type: directory
     register: seznam_slozek
     
   - name: debug
     debug:
      msg: "C:\\Ansible\\{{ item.filename }}\\Documents\\"
     with_items: "{{ seznam_slozek.files }}"
     
   - name: Vytvoří složku, pokud je potřeba
     win_file: 
      path: "C:\\Ansible\\{{ item.filename }}\\Documents\\"
      state: directory
     with_items: "{{ seznam_slozek.files }}"
      
   - name: Synchronizace
     win_robocopy: 
      src: "C:\\Users\\{{ item.filename }}\\Documents\\"
      dest: "C:\\Ansible\\{{ item.filename }}\\Documents\\"
      # recurse: True ---ignorované díky flags
      # Purge bude díky flags ignorovanej
      flags: /XJ /e     #V Documents je ve skutečnosti uloženo Videa, Obrázky, Hudba, ale mají hardlink ven a tváří se, že jsou venku
     with_items: "{{ seznam_slozek.files }}"
       
